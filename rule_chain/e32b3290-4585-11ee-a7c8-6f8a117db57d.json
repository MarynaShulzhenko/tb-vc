{
  "entityType" : "RULE_CHAIN",
  "entity" : {
    "additionalInfo" : null,
    "configuration" : null,
    "debugMode" : false,
    "externalId" : {
      "entityType" : "RULE_CHAIN",
      "id" : "e32b3290-4585-11ee-a7c8-6f8a117db57d"
    },
    "firstRuleNodeId" : {
      "entityType" : "RULE_NODE",
      "id" : "bc825b00-4594-11ee-b648-4382414172b6"
    },
    "id" : {
      "entityType" : "RULE_CHAIN",
      "id" : "e32b3290-4585-11ee-a7c8-6f8a117db57d"
    },
    "name" : "Generate Report",
    "root" : false,
    "type" : "CORE"
  },
  "metaData" : {
    "connections" : [ {
      "fromIndex" : 0,
      "toIndex" : 1,
      "type" : "Success"
    }, {
      "fromIndex" : 1,
      "toIndex" : 2,
      "type" : "True"
    }, {
      "fromIndex" : 2,
      "toIndex" : 3,
      "type" : "Success"
    }, {
      "fromIndex" : 3,
      "toIndex" : 4,
      "type" : "Success"
    } ],
    "firstNodeIndex" : 0,
    "nodes" : [ {
      "additionalInfo" : {
        "description" : null,
        "layoutX" : 242,
        "layoutY" : 314
      },
      "configuration" : {
        "useSystemReportsServer" : true,
        "reportsServerEndpointUrl" : null,
        "useReportConfigFromMessage" : true,
        "reportConfig" : {
          "baseUrl" : "http://localhost:3000",
          "useDashboardTimewindow" : true,
          "timewindow" : {
            "history" : {
              "interval" : 1000,
              "timewindowMs" : 86400000
            }
          },
          "namePattern" : "report-%d{yyyy-MM-dd_HH:mm:ss}",
          "type" : "pdf",
          "timezone" : "Europe/Kiev",
          "useCurrentUserCredentials" : true,
          "userId" : "40c887d0-3835-11ee-b6c5-dd8cce90d040",
          "dashboardId" : "40c887d0-3835-11ee-b6c5-dd8cce90d040"
        }
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "bc825b00-4594-11ee-b648-4382414172b6"
      },
      "name" : "Generate Report",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.report.TbGenerateReportNode"
    }, {
      "additionalInfo" : {
        "description" : null,
        "layoutX" : 454,
        "layoutY" : 174
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return msg.sendEmail === true;",
        "tbelScript" : "return msg.sendEmail === true;"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "bc828210-4594-11ee-b648-4382414172b6"
      },
      "name" : "If send email",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : null,
        "layoutX" : 691,
        "layoutY" : 311
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "metadata['emailFrom'] = msg.emailConfig.from;\nmetadata['emailTo'] = msg.emailConfig.to;\nmetadata['emailCc'] = msg.emailConfig.cc || \"\";\nmetadata['emailBcc'] = msg.emailConfig.bcc || \"\";\nmetadata['emailSubject'] = msg.emailConfig.subject;\nmetadata['emailBody'] = msg.emailConfig.body;\nmetadata['emailTimezone'] = msg.reportConfig.timezone;\n\nreturn {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "metadata['emailFrom'] = msg.emailConfig.from;\nmetadata['emailTo'] = msg.emailConfig.to;\nmetadata['emailCc'] = msg.emailConfig.cc != null ? msg.emailConfig.cc : \"\";\nmetadata['emailBcc'] = msg.emailConfig.bcc != null ? msg.emailConfig.bcc : \"\";\nmetadata['emailSubject'] = msg.emailConfig.subject;\nmetadata['emailBody'] = msg.emailConfig.body;\nmetadata['emailTimezone'] = msg.reportConfig.timezone;\n\nreturn {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "bc82a920-4594-11ee-b648-4382414172b6"
      },
      "name" : "Prepare email metadata",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "layoutX" : 924,
        "layoutY" : 166
      },
      "configuration" : {
        "fromTemplate" : "${emailFrom}",
        "toTemplate" : "${emailTo}",
        "ccTemplate" : "${emailCc}",
        "bccTemplate" : "${emailBcc}",
        "subjectTemplate" : "${emailSubject}",
        "bodyTemplate" : "${emailBody}"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "bc82f740-4594-11ee-b648-4382414172b6"
      },
      "name" : "To report email",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.mail.TbMsgToEmailNode"
    }, {
      "additionalInfo" : {
        "layoutX" : 1135,
        "layoutY" : 313
      },
      "configuration" : {
        "useSystemSmtpSettings" : true,
        "smtpHost" : "localhost",
        "smtpPort" : 25,
        "username" : null,
        "password" : null,
        "smtpProtocol" : "smtp",
        "timeout" : 10000,
        "enableTls" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "bc831e50-4594-11ee-b648-4382414172b6"
      },
      "name" : "Send report",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.mail.TbSendEmailNode"
    } ],
    "ruleChainConnections" : null
  },
  "relations" : [ ],
  "attributes" : {
    "SERVER_SCOPE" : [ ]
  }
}